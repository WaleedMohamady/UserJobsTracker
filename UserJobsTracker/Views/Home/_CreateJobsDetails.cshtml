@using System.Web.Script.Serialization

<form id="jobForm">
    <div class="form-group">

        <div class="col-md-12">
            <div class="col-md-4 ">
                <label class="control-label">Name:</label>
            </div>
            <div class="col-md-8">
                <input id="Name" name="Name" class="k-textbox" required="required" validationMessage="Name is required" />
                <span class="k-invalid-msg" data-for="Name"></span>
            </div>
        </div>

        <div class="col-md-12">
            <div class="col-md-4 ">
                <label class="control-label">Hire Date:</label>
            </div>
            <div class="col-md-3">
                <input id="hireDate" name="HireDate" />
            </div>
        </div>

        <div class="col-md-12">
            <div class="col-md-4 ">
                <label class="control-label">Leave Date:</label>
            </div>
            <div class="col-md-3">
                <input id="leaveDate" name="LeaveDate" />
            </div>
        </div>

        <div class="col-md-12">
            <div class="col-md-4 ">
                <label class="control-label">Branch:</label>
            </div>
            <div class="col-md-3">
                <input id="BranchId" name="BranchId" />
            </div>
        </div>
    </div>

    <div class="form-group">
        <div class="col-md-12">
            <div class="col-md-offset-10">
                <input type="button" class="btn k-button btn-Save" value="Save" id="btnSave" />
            </div>
        </div>
    </div>

</form>

<script>
    var Branches = @Html.Raw(new JavaScriptSerializer().Serialize(ViewBag.Branches));

    $(document).ready(function () {
        $("#BranchId").kendoComboBox({
            dataTextField: "Name",
            dataValueField: "Id",
            dataSource: { data: Branches },
            fillMode: "flat"
        });

        $("#hireDate").kendoDatePicker({
            value: new Date(),
            format: "dd/MM/yyyy",
        });

        $("#leaveDate").kendoDatePicker({
            value: new Date(),
            format: "dd/MM/yyyy",
        });
    });

    $('.btn-Save').on('click', function () {
        var validator = $("#jobForm").kendoValidator().data("kendoValidator");
        if (!validator.validate()) {
            jAlert('invalid data');
            return;
        }

        var job = {};
        job.Name = $("#Name").val();
        job.HireDate = $("#hireDate").val();
        job.LeaveDate = $("#leaveDate").val();
        job.BranchId = $("#BranchId").data("kendoComboBox").value();
        $.ajax({
            type: 'POST',
            contentType: "application/json; charset=utf-8",
            url: '@Url.Action("Save", "Home")',
            data: JSON.stringify({ Job: job}),
            success: function (e) {
                if (e) {
                    alert('Job saved successfully');
                    $('#jobWindow').data("kendoWindow").close();
                    $('#jobsGrid').data('kendoGrid').dataSource.read();
                }
                else {
                    alert('error');
                }
            },
            error: function (xhr, textStatus, errorThrown) {
                alert('Network Error');
            }
        });
    });
</script>