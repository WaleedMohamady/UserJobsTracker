@using System.Web.Script.Serialization
@model UserJobsTracker.DAL.Models.Job

<form id="jobForm">
    <input id="Id" type="hidden" value="@Model.Id" />

    <div class="form-group">
        <div class="col-md-12">
            <div class="col-md-4 ">
                <label class="control-label">
                    @Html.Translate("Name"):
                </label>
            </div>
            <div class="col-md-8 ">
                <input id="Name" name="Name" value="@Model.Name" class="k-textbox" required="required" validationMessage="@Html.Translate("Name is required")" />
                <span class="k-invalid-msg" data-for="Name"></span>
            </div>
        </div>

        <div class="col-md-12">
            <div class="col-md-4 ">
                <label class="control-label">
                    @Html.Translate("Hire Date"):
                </label>
            </div>
        </div>

        <div class="col-md-12">
            <div class="col-md-4 ">
                <label class="control-label">
                    @Html.Translate("Branch"):
                </label>
            </div>
            <div class="col-md-8">
                <input id="BranchId" name="BranchId" value="@Model.BranchId" />
            </div>
        </div>

    </div>

    <div class="form-group">
        <div class="col-md-12">
            <div class="col-md-offset-10">
                <input type="button" class="btn k-button" value=@Html.Translate("Save") id="btnSave" />
            </div>
        </div>
    </div>
</form>

<script>

    var Branches = @Html.Raw(new JavaScriptSerializer().Serialize(ViewBag.Branches));

    $(document).ready(function() {
        $("#BranchId").kendoComboBox({
            dataTextField: "Name",
            dataValueField: "Id",
            dataSource: {
                data: Branches
            }
        });
    });

    $('#btnSave').on('click', function () {
        var validator = $("#jobForm").kendoValidator().data("kendoValidator");
        if (!validator.validate()) {
            jAlert('@Html.Translate("invalid data")');
            return;
        }

        var job = {};
        job.Id = $("#Id").val();
        job.Name = $("#Name").val();
        job.HireDate = $("#HireDate").val();
        job.BranchId = $("#BranchId").data("kendoComboBox").value();
        $.ajax({
            type: 'POST',
            contentType: "application/json; charset=utf-8",
            url: '@Url.Action("Edit", "Home")',
            data: JSON.stringify({ Job: job }),
            success: function (e) {
                if (e) {
                    jAlert('@Html.Translate("Job saved successfully")');
                    $('#jobWindow').data("kendoWindow").close();
                    $('#jobsGrid').data('kendoGrid').dataSource.read();
                }
                else
                {
                    jAlert('@Html.Translate("error")');
                }
            },
            error: function (xhr, textStatus, errorThrown) {
                AjaxError(xhr, textStatus, errorThrown, '@Html.Translate("Network Error")');
            }
        });
    });
</script>