@using System.Web.Script.Serialization
@model UserJobsTracker.BL.DTOs.UpdateJobDTO

<form id="jobForm">
    <input id="Id" type="hidden" value="@Model.Id" />

    <div class="form-group">
        <div class="col-md-12">
            <div class="col-md-4 ">
                <label class="control-label">Name:</label>
            </div>
            <div class="col-md-8 ">
                <input id="Name" name="Name" value="@Model.Name" class="k-textbox" required="required" validationMessage="Name is required" />
                <span class="k-invalid-msg" data-for="Name"></span>
            </div>
        </div>

        <div class="col-md-12">
            <div class="col-md-4 ">
                <label class="control-label">Hire Date:</label>
            </div>
            <div class="col-md-3">
                <input id="hireDate" name="HireDate" value="@Model.HireDate" />
            </div>
        </div>

        <div class="col-md-12">
            <div class="col-md-4 ">
                <label class="control-label">
                    Branch:
                </label>
            </div>
            <div class="col-md-3">
                <input id="BranchId" name="BranchId" value="@Model.BranchId" />
            </div>
        </div>

    </div>

    <div class="form-group">
        <div class="col-md-12">
            <div class="col-md-offset-10">
                <input type="button" class="btn k-button" value="Save" id="btnSave" />
            </div>
        </div>
    </div>
</form>

<script>

    var Branches = @Html.Raw(new JavaScriptSerializer().Serialize(ViewBag.Branches));

    $(document).ready(function() {
        $("#BranchId").kendoComboBox({
            dataTextField: "Name",
            dataValueField: "Id",
            dataSource: { data: Branches },
            fillMode: "flat"
        });

        $("#hireDate").kendoDateTimePicker({
            value: new Date()
        });
    });

    $('#btnSave').on('click', function () {
        var validator = $("#jobForm").kendoValidator().data("kendoValidator");
        if (!validator.validate()) {
            alert('invalid data');
            return;
        }

        var job = {};
        job.Id = $("#Id").val();
        job.Name = $("#Name").val();g
        job.HireDate = $("#hireDate").val();
        job.BranchId = $("#BranchId").data("kendoComboBox").value();
        $.ajax({
            type: 'POST',
            contentType: "application/json; charset=utf-8",
            url: '@Url.Action("Edit", "Home")',
            data: JSON.stringify({ updateJobDTO: job }),
            success: function (e) {
                if (e) {
                    alert('Job saved successfully');
                    $('#jobWindow').data("kendoWindow").close();
                    $('#jobsGrid').data('kendoGrid').dataSource.read();
                }
                else
                {
                    alert('error');
                }
            },
            error: function (xhr, textStatus, errorThrown) {
                alert('Network Error');
            }
        });
    });
</script>